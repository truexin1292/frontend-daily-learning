<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>event-loop</title>
</head>
<body>
<script>

    // process.nextTick和promise.then同为微任务，
    // 在node环境下process.nextTick的优先级高于promise.then
    // 先进先出

    // todo 只是为了说原理吧，浏览器可以加个
    window.process = {
        nextTick: function (f) {
            new Promise(function (resolve) {
                resolve();
            }).then(f);
        }
    }

    /* // demo1
       console.log('1');

       setTimeout(function () {
           console.log('2');

           // process.nextTick(function () { // todo 先进先出 1
           //     console.log('3');
           // })

           new Promise(function (resolve) {
               console.log('4');
               resolve();
           }).then(function () { // todo 先进先出
               console.log('5')
           })

           process.nextTick(function () { // todo 先进先出 2
               console.log('3');
           })
       })
       process.nextTick(function () {
           console.log('6');
       })
       new Promise(function (resolve) {
           console.log('7');
           resolve();
       }).then(function () {
           console.log('8')
       })

       setTimeout(function () {
           console.log('9');
           process.nextTick(function () {
               console.log('10');
           })
           new Promise(function (resolve) {
               console.log('11');
               resolve();
           }).then(function () {
               console.log('12')
           })
       })

       // 1 7 8 2 4 5 3 6 9 11 12 10 // 错误❌
       // 1，7，6，8，2，4，3，5，9，11，10，12 //准确✅ 1
       // 1，7，6，8，2，4，5，3，9，11，10，12 //准确✅ 2
   */

    // demo2
    console.log('1');
    setTimeout(function () {
        console.log('2');
        process.nextTick(function () {
            console.log('3');
        })
        new Promise(function (resolve) {
            console.log('4');
            resolve();
        }).then(function () {
            console.log('5')
        })
    })
    process.nextTick(function () {
        console.log('6');
    })
    new Promise(function (resolve) {
        console.log('7');
        resolve();
    }).then(function () {
        console.log('8')
    })
    setTimeout(function () {
        console.log('9');
        process.nextTick(function () {
            console.log('10');
        })
        new Promise(function (resolve) {
            console.log('11');
            resolve();
        }).then(function () {
            console.log('12')
        })
    })
    setTimeout(function () {
        console.log('13');
        process.nextTick(function () {
            console.log('14');
        })
        new Promise(function (resolve) {
            console.log('15');
            resolve();
        }).then(function () {
            console.log('16')
        })
    })

    // 1 7 6 8 2 4 3 5 9 11 10 12 13 15 14 16 // ✔️
</script>
</body>
</html>
